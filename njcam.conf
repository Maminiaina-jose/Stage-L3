<VirtualHost *:8080>
    ServerName njcam.com
    DocumentRoot /var/www/NJCAM/njcam/dist

    <Directory /var/www/NJCAM/njcam/dist>
        # Définir la politique de sécurité du contenu
         Header set Content-Security-Policy "default-src 'self'; img-src 'self' https://your-image-source.com https://fastly.picsum.photos https://via.placeholder.com 'data:'; style-src 'self' https://fonts.googleapis.com 'unsafe-inline'; style-src-elem 'self' https://fonts.googleapis.com 'unsafe-inline'; font-src 'self' https://fonts.gstatic.com data:; connect-src 'self' http://localhost:8088;"
        # Autorisation de la réécriture et les overrides
        AllowOverride All
        Require all granted

         # Ajouter les règles de réécriture ici
        <IfModule mod_rewrite.c>
            RewriteEngine On
            RewriteBase /
            RewriteRule ^index\.html$ - [L]
            RewriteCond %{REQUEST_FILENAME} !-f
            RewriteCond %{REQUEST_FILENAME} !-d
            RewriteRule . /index.html [L]
        </IfModule>
    </Directory>

    # Alias pour phpMyAdmin
    Alias /phpmyadmin /usr/share/phpmyadmin

    <Directory /usr/share/phpmyadmin>
        Options FollowSymLinks
        DirectoryIndex index.php
        AllowOverride None
        Require all granted
    </Directory>

    # Configuration des fichiers PHP avec PHP-FPM
    <FilesMatch \.php$>
        SetHandler "proxy:unix:/run/php/php8.3-fpm.sock|fcgi://localhost"
    </FilesMatch>

    # Activation des logs d'erreur et les logs d'accès personnalisés
    ErrorLog ${APACHE_LOG_DIR}/njcam_error.log
    CustomLog ${APACHE_LOG_DIR}/njcam_access.log combined
</VirtualHost>
